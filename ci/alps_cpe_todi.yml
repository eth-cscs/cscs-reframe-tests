include:
  - remote: 'https://gitlab.com/cscs-ci/recipes/-/raw/master/templates/v2/.ci-ext.yml'

stages:
  - tests

my job on todi:
  stage: tests    
  extends: .f7t-baremetal-runner
  variables:
    F7T_URL: 'https://firecrest-todi.v1.tds.cscs.ch'
    FIRECREST_SYSTEM: 'todi'
  before_script:
    - echo "FIRECREST_SYSTEM=$FIRECREST_SYSTEM"
    - echo "F7T_URL=$F7T_URL"
    - echo "CLUSTER_NAME=$CLUSTER_NAME"
    - echo "SLURM_PARTITION=$SLURM_PARTITION"
    - echo "RFM_MODE=$RFM_MODE"
    - echo "TAG=$TAG"
    - echo "UARCH=$UARCH"
    - uname -a
    - pwd
  script:
    - hostname
    - rfm_path=$(./ci/scripts/alps_uenv.sh install_reframe)
    - echo "rfm_path=$rfm_path"
    - export PATH=$rfm_path:$PATH
    - reframe -V
    - ./ci/scripts/alps_uenv.sh launch_reframe
  artifacts:
    when: on_failure
    paths:
      - report.xml
    reports:
      junit: report.xml
